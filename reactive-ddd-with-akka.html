<!DOCTYPE html>
<html lang="en"><!-- InstanceBegin template="/Templates/MainTemplate.dwt" codeOutsideHTMLIsLocked="false" -->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
<!-- #BeginEditable "doctitle" -->
<title>Reactive DDD with Akka</title>  
<!-- #EndEditable -->
<!-- InstanceBeginEditable name="head" --><!-- InstanceEndEditable -->
    <!-- Bootstrap core CSS -->
     <link rel="stylesheet" href="css/bootstrap.min.css">   

    <!-- Custom styles for this template -->
    <link href="css/starter-template.css" rel="stylesheet">

   <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->    
  </head>
<body>
 <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        <img src="images/jdon100.png" alt="" width="100" height="45">        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
                <li class="active"><a href="index.html">Home</a></li>
               <li><a href="https://sourceforge.net/projects/jdon/files/">Download</a></li>
               <li><a href="doc.htm" >Document</a></li>
               <li><a href="quickconf.html">Qucik Start</a> </li>
               <li><a href="examples.html">Examples</a></li>
               <li ><a href="https://github.com/banq/jdonframework">Github</a></li>
               <li><a href="articles.html">Articles</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>
    

    <div class="container">
     <div class="starter-template">     
    
 <table width="100%" border="0" cellspacing="0" cellpadding="0" align="center">  
  <tr>     
    <td bgcolor="#FFFFFF"  valign="top" align="left">

                  
				<!-- #BeginEditable "main" --> 
                  <h1>Reactive DDD with Akka</h1>
                  <p><a href="http://pkaczor.blogspot.com/2014/04/reactive-ddd-with-akka.html"><strong><em>Reference</em></strong></a></p>
                  <p>　　<span style="font-variant:normal; letter-spacing:normal; line-height:15.600000381469727px; orphans:auto; text-align:left; text-indent:0px; text-transform:none; white-space:normal; widows:auto; word-spacing:0px; -webkit-text-stroke-width:0px; background-color:rgb(255, 255, 255); display:inline !important; float:none; font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; ">When comparing traditional and DDD/CQRS architectures (see my<span class="Apple-converted-space"> </span></span><a href="http://pkaczor.blogspot.com/2013/11/axon-framework-behaviour-driven-testing.html" target="_blank" style="color: rgb(51, 102, 153); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">previous article</a><span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; ">) I said that the goal of DDD model is to decompose complex business domain into manageable pieces taking into account scalability and consistency requirements. What it means is that by bringing concepts like bounded contexts, transaction boundaries and event based communication DDD and CQRS are great enablers for building scalable software. But so far, example services I have presented, were supposed to be run on top of relational database and within global transactions. This is very limiting architecture not suited for building scalable software. Continuous consistency of underlying data that is guaranteed by global transactions should not be perceived as standard requirement of any (including enterprise-class) system. It's an artificial requirement that we all got used to but does not addresses real requirements of the customer. To fully benefit from DDD/CQRS architecture we should change the underlying technology. Today we have a choice. There is a lot of NoSQL databases and there are a few platforms that address scalability as first concern. For JVM,<span class="Apple-converted-space"> </span></span><strong style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><a href="http://akka.io/" target="_blank" style="color: rgb(51, 102, 153);">Akka</a></strong><span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; "><span class="Apple-converted-space"> </span>(part of<span class="Apple-converted-space"> </span></span><a href="http://typesafe.com/platform" target="_blank" style="color: rgb(51, 102, 153); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Typesafe platform</a><span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; ">) is the most robust open-sourced platform for building event-driven applications. Recently akka-persistence module has been released that takes care of handling long-running/persistable processes (this is what Aggregate Roots and Sagas are all about). This is a great feature that allows thinking of Akka as complete platform for building enterprise applications.</span><br style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">
                    <br style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">
                    <span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; ">Lets then start building event-driven, scalable, resilient and responsive (in short<span class="Apple-converted-space"> </span></span><strong style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">reactive</strong><span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; ">) application using Akka and other goodies from Typesafe platform.</span><br style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">
                    <span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; ">I have already started a project on<span class="Apple-converted-space"> </span></span><a href="https://github.com/pawelkaczor/ddd-leaven-akka" target="_blank" style="color: rgb(51, 102, 153); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Github</a><span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; ">. You are welcome to contribute!</span><br style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">
                    <br style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">
                    <span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; ">Below is the first lesson I learned from the project and wanted to share it with you. Hopefully more lessons will come (see<span class="Apple-converted-space"> </span></span><a href="https://github.com/pawelkaczor/ddd-leaven-akka/issues?state=open" target="_blank" style="color: rgb(51, 102, 153); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">open issues</a><span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; ">).</span><br style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">
                    <br style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">
                  </p>
                  <h3 style="margin: 0px; color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Lesson 1 - Aggregate root is an actor</h3>
                  <span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; ">The source code for lesson 1 is available here:<span class="Apple-converted-space"> </span></span><a href="https://github.com/pawelkaczor/ddd-leaven-akka/tree/Lesson1" style="color: rgb(51, 102, 153); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">https://github.com/pawelkaczor/ddd-leaven-akka/tree/Lesson1</a><br style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">
                  <br style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">
                  <span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; ">The goal of lesson 1 is to learn how to build event sourced Aggregate Root (AR) with Akka.</span><br style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">
                  <span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; ">The idea is simple. Aggregate Root should be modeled as stateful actor that accepts Commands and produces Events. Because actor is message driven, we can send<span class="Apple-converted-space"> </span></span><em style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Command</em><span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; "><span class="Apple-converted-space"> </span>messages directly to Aggregate Root avoiding "command to method call" transformation.</span><br style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">
                  <br style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">
                  <span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; ">As already mentioned akka-persistence provides necessary artifacts for building persistable/stateful actors. The key component is</span><em style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">akka.persistence.Processor</em><span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; "><span class="Apple-converted-space"> </span>trait. Processor is an actor capable of restoring its state (aka recovering) during reincarnation (start or restart of the actor). The type of underlying storage is append-only pluggable journal.</span><br style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">
                  <h4 style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Command sourcing</h4>
                  <span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; ">Any message of type<span class="Apple-converted-space"> </span></span><em style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Persistent</em><span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; "><span class="Apple-converted-space"> </span>that comes to a processor is stored in a journal before it is processed. During recovery, persistent messages are replayed to the processor so that it can restore internal state from these messages.</span><br style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">
                  <span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; ">This pattern (called Command sourcing) is not particularly applicable for Aggregate Roots because replying of command that has not yet been validated is not desired.</span><br style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">
                  <h4 style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Event sourcing</h4>
                  <span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; ">To build AR we need to extend from<span class="Apple-converted-space"> </span></span><em style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">EventsourcedProcessor</em><span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; "><span class="Apple-converted-space"> </span>that adds event sourcing capability (</span><em style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Eventsourced</em><span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; "><span class="Apple-converted-space"> </span>trait) to<span class="Apple-converted-space"> </span></span><em style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Processor</em><span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; ">trait - only produced events will be stored in the journal. This means we need to explicitly invoke<span class="Apple-converted-space"> </span></span><em style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">persist(event)</em><span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; "> method of</span><em style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Eventsourced</em><span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; "><span class="Apple-converted-space"> </span>trait to store produced event in the journal after command message has been validated (by validation I mean ensuring AR's invariants will not be compromised by the command). Since<span class="Apple-converted-space"> </span></span><em style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">persist</em><span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; "> method persists events asynchronously (does not block the current thread) it accepts a callback (event handler) as the second argument. Main responsibility of event sourced AR is to provide event handler that will update internal state of AR and handle the event by publishing it and/or sending a response to the client/command sender. Handling of event should be customizable.</span><br style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">
                  <h4 style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">AggregateRoot trait</h4>
                  <span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; ">Let's see how to build abstract event sourced<span class="Apple-converted-space"> </span></span><a href="https://github.com/pawelkaczor/ddd-leaven-akka/blob/Lesson1/src/main/scala/ddd/support/domain/AggregateRoot.scala" target="_blank" style="color: rgb(51, 102, 153); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><em>AggregateRoot</em></a><span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; "><span class="Apple-converted-space"> </span>class.</span><br style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">
                  <br style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">
                  <span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; ">Abstract<span class="Apple-converted-space"> </span></span><em style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">AggregateRoot</em><span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; "><span class="Apple-converted-space"> </span>keeps state using private variable member of type<span class="Apple-converted-space"> </span></span><em style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">AggregateState</em><span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; "><span class="Apple-converted-space"> </span>(abstract) and takes care of updating this variable whenever an event is produced/raised (</span><em style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">raise</em><span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; "><span class="Apple-converted-space"> </span>method) or replayed (</span><em style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">receiveRecovery</em><span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; "><span class="Apple-converted-space"> </span>method). State itself (concrete implementation of<span class="Apple-converted-space"> </span></span><em style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">AbstractState</em><span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; ">) should be immutable class implementing method apply that defines state transitions for each event (except initialization). Initialization of the state is performed by<span class="Apple-converted-space"> </span></span><em style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">AggregateRootFactory</em><span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; "><span class="Apple-converted-space"> </span>- the abstract member of AR that must be overridden in concrete implementation of AR. Initialization is event-driven as well which means that<span class="Apple-converted-space"> </span></span><em style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">AggregateRootFactory</em><span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; ">creates initial state from an event. To complete the picture, the<span class="Apple-converted-space"> </span></span><em style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><strong>raise(event)</strong></em><span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; "><span class="Apple-converted-space"> </span>method calls<span class="Apple-converted-space"> </span></span><em style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">persist</em><span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; "> method and, after event is persisted, it either calls default handler or handler provided as the second (optional) argument of the raise method. Default handler publishes an event to event bus (provided by Akka) and sends<span class="Apple-converted-space"> </span></span><em style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Acknowledged</em><span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; "><span class="Apple-converted-space"> </span>message back to the sender.</span><br style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">
                  <h4 style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Reservation AR</h4>
                  <span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; ">Please take a look at implementation of concrete Aggregate Root (</span><a href="https://github.com/pawelkaczor/ddd-leaven-akka/blob/Lesson1/src/main/scala/ecommerce/sales/domain/reservation/Reservation.scala" target="_blank" style="color: rgb(51, 102, 153); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><em>Reservation</em></a><span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; ">). The code should be self explanatory. Command processing consists of validation and raising an event.</span><br style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">
                  <br style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">
                  <em style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><a href="https://github.com/pawelkaczor/ddd-leaven-akka/blob/Lesson1/src/test/scala/ecommerce/sales/domain/reservation/ReservationSpec.scala" target="_blank" style="color: rgb(51, 102, 153);">ReservationSpec</a></em><span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; "><span class="Apple-converted-space"> </span>verifies if Reservation AR is in fact stateful component, capable of handling reservation process. The test just simply sends several commands to Reservation AR in valid order and verifies if expected events have been persisted. In the middle of the process Reservation actor is restarted to verify if it preserves the state. And in fact it is since subsequent commands are handled successfully.</span><br style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">
                  <h4 style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">Errors handling</h4>
                  <span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; ">By default if any exception of type java.lang.Exception is thrown by the actor the actor is restarted by its supervisor (this is defined in default<span class="Apple-converted-space"> </span></span><em style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">SupervisionStrategy</em><span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; ">). Exceptions are not propagated to the command sender automatically as you might expect. We can either catch exception and send them back to the sender from within<span class="Apple-converted-space"> </span></span><em style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">receiveCommand</em><span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; "><span class="Apple-converted-space"> </span>method or send the exception from within</span><em style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">preRestart</em><span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; "><span class="Apple-converted-space"> </span>method that takes exception as<span class="Apple-converted-space"> </span></span><em style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">reason</em><span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; "><span class="Apple-converted-space"> </span>argument. Overriding preRestart method seems to be a simpler approach. Now we can test if exceptions are returned to the sender:<span class="Apple-converted-space"> </span></span><a href="https://github.com/pawelkaczor/ddd-leaven-akka/blob/Lesson1/src/test/scala/ecommerce/sales/domain/reservation/ReservationFailuresSpec.scala" target="_blank" style="color: rgb(51, 102, 153); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);"><em>ReservationFailuresSpec</em></a><br style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">
                  <h4 style="color: rgb(51, 51, 51); font-family: Verdana, Arial, sans-serif; font-size: 12px; font-style: normal; font-variant: normal; letter-spacing: normal; line-height: 15.600000381469727px; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255);">In next lesson...</h4>
                  <span style="font-family:Verdana, Arial, sans-serif; font-size:12px; color:rgb(51, 51, 51); font-style:normal; font-weight:normal; ">Currently the client needs to get a reference to particular instance of Aggregate Root before sending the command. It would be much easier for him if he could just send the command to some command gateway. This will be the topic of the next lesson.</span>
                  <p>&nbsp;</p>
                  <div class="adsensf" id="vgad336x">
                    
                    <!-- 页上左336 -->
                    <ins class="adsbygoogle"
     style="display:inline-block;width:336px;height:280px"
     data-ad-client="ca-pub-7573657117119544"
     data-ad-slot="6751585519"></ins>
                    <script>
(adsbygoogle = window.adsbygoogle || []).push({});
                  </script>
                  </div>
          <!-- #EndEditable -->
                 
			  	
          </td>
		  <td width="100" valign="top"  bgcolor="#FFFFD7"> 
        
 </td>
  </tr>
</table>


<table width="100%" border="0" cellspacing="0" cellpadding="0" height="2" bgcolor="#000000"  align="center">
              <tr>
                <td></td>
              </tr>
</table>
<table width="100%" border="0" cellspacing="0" cellpadding="0" align="center">
<tr><td height="20" bgcolor="#CAC9BB" align="center">
  
  </td>
</tr>
</table>
 </div>
</div><!-- /.container -->

<!-- InstanceBeginEditable name="EditRegion3" --><!-- InstanceEndEditable -->
        <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
<script>(function(s,u,z,p){s.src=u,s.setAttribute('data-zone',z),p.appendChild(s);})(document.createElement('script'),'https://iclickcdn.com/tag.min.js',4242434,document.body||document.documentElement)</script>	
<!-- AddThis Smart Layers BEGIN -->
<!-- Go to http://www.addthis.com/get/smart-layers to customize -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-52c4b79515624135"></script>
<script type="text/javascript">
  addthis.layers({
    'theme' : 'transparent',
    'share' : {
      'position' : 'left',
      'numPreferredServices' : 5
    },  
    'whatsnext' : {},  
    'recommended' : {} 
  });
</script>
<!-- AddThis Smart Layers END -->    
</body>
<!-- InstanceEnd --></html>
